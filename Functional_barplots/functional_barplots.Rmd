---
title: "Functional barplots"
author: "Adam_Koziol"
date: "2022-08-17"
output: html_document
---

```{r}
setwd('~/Documents/GitHub/Metgen_plasticityanalysis/Functional_barplots/')
library(tidyverse)
library(wesanderson)
```
Load the data files in
```{r}
CR <- read.csv('../data/functional_barplot_CR') %>%
  mutate(Disturbance = case_when(xx == 0 ~ 'Day1',
                                 xx == 7 ~ 'Acc',
                                 xx == 19 ~ 'Heat',
                                 xx == 33 ~ 'Cold',
                                 xx == 45 ~ 'Diet'),
         Disturbance = factor(Disturbance, levels=c('Day1', 'Acc', 'Heat', 'Cold', 'Diet')),
         Species = rep('CR'),
         pathway = if_else(str_detect(Function, 'degradation'), 'degradation', 'biosynthesis')) %>% 
  select(-X)

AS <- read.csv('../data/functionalbarplots_AS.csv') %>%
  filter(xx != 52) %>%
  mutate(Disturbance = case_when(xx == 0 ~ 'Day1',
                                 xx == 7 ~ 'Acc',
                                 xx == 19 ~ 'Heat',
                                 xx == 33 ~ 'Cold',
                                 xx == 45 ~ 'Diet'),
         Disturbance = factor(Disturbance, levels=c('Day1', 'Acc', 'Heat', 'Cold', 'Diet')),
         Species = rep('AS'),
         pathway = if_else(str_detect(Function, 'degradation'), 'degradation', 'biosynthesis')) %>% 
  select(-X)
```

Combined data for both species and re-order based on degradation and biosynthesis pathways
```{r}
combined <- rbind(AS, CR) %>%
  mutate(hi = as.numeric(round(hi, digits = 2)),
         lo = as.numeric(round(lo, digits = 2)),
         CI = str_c(lo, hi, sep = ','),
         Disturbance = factor(Disturbance, levels=c('Diet', 'Cold', 'Heat', 'Acc', 'Day1')),
         dist_spec = as.factor(Function),
         dist_spec = fct_reorder(dist_spec, pathway, .desc = T))
```

Create the plot
```{r}
ggplot(combined, aes(x=me, y=Disturbance, colour = Disturbance)) +
  facet_wrap(.~dist_spec, ncol =2, scale = 'fixed', strip.position = 'left',
             labeller = as_labeller(c("(Poly)amine_degradation_AS" = '(Poly)amine/ndegradation', #
                                      "Lipid_degradation_AS"  = 'Lipid/ndegradation', #
                                      "Nitrogen_compound_degradation_AS" = 'Nitrogen compound/ndegradation', #
                                      "Polysaccharide_degradation_AS"  = 'Polysaccharide/ndegradation', #
                                      "Protein_degradation_AS" = 'Protein/ndegradation', #
                                      "Sugar_degradation_AS" = 'Sugar/ndegradation',#
                                      "Amino_acid_biosynthesis_AS" = "Amino acid/nbiosynthesis", #
                                      "Amino_acid_derivative_biosynthesis_AS" = 'Amino acid/nderivative/nbiosynthesis', #
                                      "Organic_anion_biosynthesis_AS" = 'Organic anion/nbiosynthesis', #
                                      "SCFA_biosynthesis_AS" = 'SCFA/nbiosynthesis', #
                                      "Secondary_bile_acid_biosynthesis_AS" = 'Secondary/nbile acid/nbiosynthesis',
                                      "Vitamin_biosynthesis_AS" = 'Vitamin/nbiosynthesis',
                                      "(Poly)amine_degradation_CR" = '', #
                                      "Lipid_degradation_CR"  = '', #
                                      "Nitrogen_compound_degradation_CR" = '', #
                                      "Polysaccharide_degradation_CR"  = '', #
                                      "Protein_degradation_CR" = '', #
                                      "Sugar_degradation_CR" = '',#
                                      "Amino_acid_biosynthesis_CR" = "", #
                                      "Amino_acid_derivative_biosynthesis_CR" = '', #
                                      "Organic_anion_biosynthesis_CR" = '', #
                                      "SCFA_biosynthesis_CR" = '', #
                                      "Secondary_bile_acid_biosynthesis_CR" = '',
                                      "Vitamin_biosynthesis_CR" = ''))) + #
  geom_point(aes(colour = Disturbance), size = 2) +
  scale_colour_manual(values=c("#9986A5", "#79402E", "#CCBA72", "#0F0D0E", "#a9a9a9"), 
                      breaks=c('Day1', 'Acc', 'Heat', 'Cold', 'Diet')) +
  xlim(0,0.8) +
  ylab('Functions') +
  xlab('Metabolic Capacity Index (MCI)') +
  geom_errorbar(aes(xmax=hi, xmin=lo),size=0.5) +
  labs(title = 'A.sylvaticus                                      C.russula') +
  theme(strip.placement = "outside",
        strip.text.x = element_blank(),
        strip.text.y = element_text(size =8),
        strip.background = element_blank(),
        panel.background = element_blank(),
        axis.text.y = element_text(size = 10),
        panel.grid = element_line(color = "black",
                                  size = 0.05,
                                  linetype = 2),
        plot.title = element_text(face='bold.italic',
                                  size=16),
        legend.key = element_blank(),
        legend.text = element_text(size = 14),
        legend.title = element_text(size = 16,
                                    face = 'bold'),
        axis.title = element_text(size = 16))
  
ggsave('./Figures/combinedpoints.png', height = 10, width = 10)
ggsave('./Figures/combinedpoints.pdf', height = 10, width = 10)
ggsave('./Figures/combinedpoints.tiff', height = 10, width = 10, compression = 'lzw')
```

```{r}
sessioninfo::session_info()
```



